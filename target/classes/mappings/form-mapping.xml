<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="FormDAO">
	<insert id="insertForm">
		<![CDATA[
			INSERT INTO RCVAPPL(SSN, RCV_D, RCV_SEQ_NO, CUST_NO, APPL_D, BIRTH_D, HG_NM, ENG_NM, STL_MTD, STL_ACT, BNK_CD, STL_DD, APPL_CLAS, STMT_SND_MTD, BILLADR_ADR1, BILLADR_ADR2, BILLADR_ZIP, HDP_NO, BRD, SCRT_NO, EMAIL_ADR, IMPSB_CLAS)
			VALUES(#{ssn}, SYSDATE, (SELECT NVL(MAX(RCV_SEQ_NO), 0) + 1 FROM RCVAPPL), (SELECT LPAD((CUST_NO + 1), 9, '0') FROM SEQNOTBL), #{applD}, #{birthD}, #{hgNm}, #{engNm}, #{stlMtd}, #{stlAct}, #{bnkCd}, #{stlDd}, #{applClas}, #{stmtSndMtd}, #{billadrAdr1}, #{billadrAdr2}, #{billadrZip}, #{hdpNo}, #{brd}, #{scrtNo}, #{emailAdr}, #{impsbClas})
		]]>
	</insert>

	<insert id="insertCustomer">
		<![CDATA[
			INSERT INTO CUST(CUST_NO, SSN, REG_D, HG_NM, BIRTH_D, HDP_NO)
			VALUES((SELECT LPAD((CUST_NO + 1), 9, '0') FROM SEQNOTBL), #{ssn},
			(SELECT SUBSTR(APPL_D, 3) FROM RCVAPPL WHERE SSN = #{ssn}), #{hgNm}, #{birthD}, #{hdpNo})
		]]>
	</insert>

	<insert id="insertCard">
		<![CDATA[
			INSERT INTO CRD(CRD_NO, CUST_NO, SSN, VLD_DUR, BRD, SCRT_NO, ENG_NM, CRD_GRD)
			VALUES((SELECT LPAD((CRD_NO + 1), 9, '0') FROM SEQNOTBL),
			(SELECT LPAD((CUST_NO + 1), 9, '0') FROM SEQNOTBL), #{ssn}, (SELECT SUBSTR(APPL_D, 3, 4) + 499 FROM RCVAPPL WHERE SSN = #{ssn}) , #{brd}, #{scrtNo}, #{engNm}, '1')
		]]>
	</insert>

	<insert id="insertBill">
		<![CDATA[
			INSERT INTO BILL(CUST_NO, STL_ACT, BNK_CD, DPS_NM, STL_MTD, STL_DD, STMT_SND_MTD, BILL_ZIP, BILL_ADR1, BILL_ADR2, EMAIL_ADR)
			VALUES((SELECT LPAD((CUST_NO + 1), 9, '0') FROM SEQNOTBL), #{stlAct}, #{bnkCd}, #{hgNm}, #{stlMtd}, #{stlDd}, #{stmtSndMtd}, #{billadrZip}, #{billadrAdr1}, #{billadrAdr2}, #{emailAdr})
		]]>
	</insert>

	<update id="updateCustNo">
		UPDATE SEQNOTBL
		SET CUST_NO = LPAD((CUST_NO + 1), 9,
		'0')
	</update>

	<update id="updateCrdNo">
		UPDATE SEQNOTBL
		SET CRD_NO = LPAD((CRD_NO + 1), 9,
		'0')
	</update>


	<update id="updateForm">
		<![CDATA[
			SELECT * FROM RCVAPPL
		]]>
	</update>

	<select id="getForm" resultType="form">
		<![CDATA[
			SELECT * FROM RCVAPPL
			WHERE SSN = #{ssn}
			
		]]>
	</select>

	<select id="getFormList" resultType="form">
		<![CDATA[
			SELECT * FROM RCVAPPL
			WHERE APPL_CLAS = #{applClas}			
		]]>
	</select>

	<select id="getApplClasList" resultType="common">
		<![CDATA[
			SELECT * FROM COMM_CODE_DTL
			WHERE GROUP_CD = 'C007'			
		]]>
	</select>

	<select id="getBrdList" resultType="common">
		<![CDATA[
			SELECT * FROM COMM_CODE_DTL
			WHERE GROUP_CD = 'C004'			
		]]>
	</select>

	<select id="getStlDdList" resultType="common">
		<![CDATA[
			SELECT * FROM COMM_CODE_DTL
			WHERE GROUP_CD = 'C009'			
		]]>
	</select>

	<select id="getStlMtdList" resultType="common">
		<![CDATA[
			SELECT * FROM COMM_CODE_DTL
			WHERE GROUP_CD = 'C002'			
		]]>
	</select>

	<select id="getBnkCdList" resultType="common">
		<![CDATA[
			SELECT * FROM COMM_CODE_DTL
			WHERE GROUP_CD = 'C003'			
		]]>
	</select>


	<select id="getStmtSndMtdList" resultType="common">
		<![CDATA[
			SELECT * FROM COMM_CODE_DTL
			WHERE GROUP_CD = 'C006'			
		]]>
	</select>

	<select id="ssnCheck" resultType="int">
		<![CDATA[
			SELECT COUNT(*) FROM RCVAPPL
			WHERE SSN = #{ssn}
			AND APPL_D = #{applD}
			AND APPL_CLAS = #{applClas}
		]]>
	</select>


	<select id="brdCheck" resultType="int">
		<![CDATA[
			SELECT
			COUNT(*)
			FROM RCVAPPL
			WHERE SSN = #{ssn}
			AND BRD = #{brd}
		]]>
	</select>


</mapper>
